# CSV Heirarchy ImporterI loosely based a [development code task](https://gist.github.com/davemcp/4b026cd9d0320454e2f5) on a proplem I encountered in my day job.An existing CSV import for users was causing problems with timeouts when the row count was larger than around ~500. My intention was to create a process that wasn't so memory intensive and could then be used with a background task (not included here). There are some legacy parts that have remained and are also related to the app it was ripped out of.Users passing in poor data was the primary culpret. e.g.: Circular reporting (userA reports to userA, or userA reports to userB who reports to userB); the user being reported to not existing; the user being reported to appearing further down the CSV/Spreadsheet.I proposed and built a heirarchy that would discover these kinds of issues and not cause a catestrophic failure.For this code example, I've obviously ripped as much of the original application as I could out. But it is not yet a simple demonstration.## UserImportFormThis was legacy. It's simply left in as the primary path for data to be passed into my process. It opens the file and passes the array through to the Importer. A better approach here would be to make the UserImporter the primary path and have the UserImportForm handle validation of each user row, and having the UserImportForm#open_spreadsheet method turned into a registry exposing the different strategy objects for the different file types provided. Time and client needs saw those kinds of nice to haves dropped.## UserImporterThis grabs the array, recursively loops through and passes it into the UserHierarchyBuilder.## UserHierarchyBuilderThis is the heirarchy. Upon initialisation it is provided the existing users to ensure heirarchy exists in it's entirity (allows for create AND update of users which was also a requirement).## UserImported::UserThis is a bit legacy/stuck in the app. For a clean example I'd move this out somewhere that makes more sense (in this vanilla app) and rename it. "Cleaner/Wrapper"? Intent here is to provide a small "user" that can be validated and used for committing (for this import process) prior to the creation the full User (which in app has a LOT of business logic).## Final notesIn truth using a CSV file to represent heirarchical data is a doomed concept. Makes for an interesting problem though. Because of the nature of this case along with the business need, I don't think there is a "right" answer. Just a series of better vs unworkable solutions.